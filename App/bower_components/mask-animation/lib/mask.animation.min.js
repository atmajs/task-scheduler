!function(t,n){"use strict";null==t&&"undefined"!=typeof global&&(t=global);var i=function(){return n(t,t.mask)};if("object"==typeof exports)module.exports=i();else if("function"==typeof define&&define.amd)define(i);else{var e=i();for(var r in e)t.mask[r]=e[r]}}(this,function(t,n){"use strict";function i(t){return t instanceof Array}function e(t){return"function"==typeof t}function r(t,n){return function(){switch(arguments.length){case 0:return n.call(t);case 1:return n.call(t,arguments[0]);case 2:return n.call(t,arguments[1]);default:return n.apply(t,arguments)}}}var s=document.createElement("div").style,o=function(){return"transform"in s?"":"webkitTransform"in s?"webkit":"MozTransform"in s?"Moz":"OTransform"in s?"O":"msTransform"in s?"ms":""}(),a=function(){for(var t=["transition","webkitTransition","MozTransition","OTransition","msTransition"],n=0,i=t.length;i>n;n++)if(t[n]in s)return!0;return!1}(),l=o?"-"+o.toLowerCase()+"-":"",u=function(){var t=(document.createElement("div"),{transition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"}),n=null;for(var i in t)if(void 0!==s[i]){n=t[i];break}return(u=function(){return n})()},h={prop:l+"transition-property",duration:l+"transition-duration",timing:l+"transition-timing-function",delay:l+"transition-delay"},m=function(){function t(t){var n=null;for(e.lastIndex=0;;){var i=e.exec(t);if(!i)return n;(n||(n={}))[i[1]]=i[0]}}function n(t){for(var n=Object.keys(t).sort().reverse(),i=0;i<n.length;i++)n[i]=t[n[i]];return n.join(" ")}function i(){this.transforms={}}var e=/([\w]+)\([^\)]+\)/g;return i.prototype={constructor:i,handle:function(i){var e=t(i.from),r=t(i.to),s=null;if(e){for(s in this.transforms)s in e==!1&&(e[s]=this.transforms[s]);i.from=n(e);for(s in e)this.transforms[s]=e[s]}for(s in this.transforms)s in r==!1&&(r[s]=this.transforms[s]);i.to=n(r);for(s in r)this.transforms[s]=r[s]}},i}(),f=function(){function t(t){var n=t.split(/ *\| */g),i={},e=n.length;i.prop=n[0]in u?l+n[0]:n[0];var r=n[1].split(/ *> */);if(r[0]&&(i.from=r[0]),i.to=r[r.length-1],e>2){var s=/(\d+m?s)?\s*([a-z]+[^\s]*)?\s*(\d+m?s)?/.exec(n[2]);if(null!=s)return i.duration=s[1]||"200ms",i.timing=s[2]||"linear",i.delay=s[3]||"0",i}return i.duration="200ms",i.timing="linear",i.delay="0",i}function n(e,r){this.parent=r,this.transformModel=r&&r.transformModel||new m;var s=e.model||e;if(i(s)){this.model=[];for(var o=0,a=s.length;a>o;o++)this.model.push(new n(s[o],this))}else if(s instanceof Object){if(s===e)return console.error('Animation Object Model has no "model" property',e),void(this.modelCount=this.nextCount=this.state=0);this.model=[new n(s,this)]}else"string"==typeof s&&(this.model=t(s),~this.model.prop.indexOf("transform")&&this.transformModel.handle(this.model));null!=e.next&&(this.next=new n(e.next,this)),this.state=0,this.nextCount=0,this.modelCount=i(this.model)?this.model.length:1,null!=this.next&&(this.nextCount=i(this.next)?this.next.length:1)}function r(t){for(var n=i(t),e=n?t.length:1,r=null,s=0;n?e>s:1>s;s++)r=n?t[s]:t,r.reset&&r.reset()}function s(t){return t?-1!==t.indexOf("ms")?parseInt(t):t.indexOf("s")?1e3*parseFloat(t):(console.warn("<mask:animation> parsing time",t),0):0}function o(t){for(var n=i(t),r=n?t.length:1,o=null,a=0,l=0;n?r>a:1>a;a++){o=n?t[a]:t;var u;u=e(o.getDuration)?o.getDuration():s(t.duration)+s(t.delay),u>l&&(l=u)}return l}function a(t,n){if(null!=t)for(var r=i(t),s=r?t.length:1,o=null,a=0;r?s>a:1>a;a++)o=r?t[a]:t,e(o.getFinalCss)?o.getFinalCss(n):n[o.prop]=o.to}var u={transform:null};return n.prototype={constructor:n,reset:function(){this.state=0,this.nextCount=0,this.modelCount=i(this.model)?this.model.length:1,null!=this.next&&(this.nextCount=i(this.next)?this.next.length:1),this.model&&r(this.model),this.next&&r(this.next)},getNext:function(){return 0===this.state?(this.state=1,this):(1===this.state&&this.modelCount>0&&--this.modelCount,1===this.state&&0===this.modelCount&&(this.state=2,this.next)?this.next:(2===this.state&&this.nextCount>0&&--this.nextCount,2===this.state&&0===this.nextCount&&this.parent?this.parent.getNext&&this.parent.getNext():null))},getDuration:function(){var t=0;return this.model&&(t+=o(this.model)),this.next&&(t+=o(this.next)),t},getFinalCss:function(t){return null==t&&(t={}),a(this.model,t),a(this.next,t),t}},n}(),c=function(){function t(){this.arr=[]}return t.prototype={constructor:t,put:function(t){if(null==t)return!1;var n,e,r=t.getNext(),s=!1;if(null==r)return!1;if(i(r)){for(e=0,n=r.length;n>e;e++)this.put(r[e])===!0&&(s=!0);return s}if(0===r.state&&(r.state=1),r.model instanceof Array){for(s=!1,e=0,n=r.model.length;n>e;e++)this.put(r.model[e])===!0&&(s=!0);return s}return this.resolve(r.model.prop),this.arr.push(r),!0},resolve:function(t){for(var n,i=0,e=this.arr.length;e>i;i++)if(n=this.arr[i],n.model.prop===t)return this.arr.splice(i,1),this.put(n);return!1},getCss:function(t,n){var i,e,r,s;for(i=0,e=this.arr.length;e>i;i++){s=this.arr[i],"from"in s.model&&(t[s.model.prop]=s.model.from),n[s.model.prop]=s.model.to;for(r in h)(n[h[r]]||(n[h[r]]=[])).push(s.model[r])}for(r in h)n[h[r]]=n[h[r]].join(",")},clear:function(){this.arr.length=0}},t}(),d=function(){function t(t){this.stack=new c,this.model=new f(t),this.duration=this.model.getDuration(),this._transitionEnd=r(this,this._transitionEnd),this.finish=r(this,this.finish),this.finishTimeout=null}for(var n,i,s=["WebKitTransitionEvent","mozTransitionEvent","oTransitionEvent","TransitionEvent"],o=0;o<s.length;o++)if(s[o]in window){i=s[o],n=window[i];break}null==i&&(i="TransitionEvent");var h={display:1,"font-family":1,visibility:1};try{new n(u(),{propertyName:"opacity",bubbles:!0,cancelable:!0})}catch(m){n=function(t,n){var e=document.createEvent(i),r="init"+i[0].toUpperCase()+i.substring(1);return e[r](u(),!0,!0,n.propertyName,0),e}}return t.prototype={constructor:t,start:function(t,n){if(this.element=t,a===!1)return this.apply(this.model.getFinalCss()),void(n&&n());t.addEventListener(u(),this._transitionEnd,!1);var i={},e={};this.onComplete=n,this.model.reset(),this.stack.clear(),this.stack.put(this.model),this.stack.getCss(i,e),this.apply(i,e),this.finishTimeout=setTimeout(this.finish,this.duration)},stop:function(){this.finish()},finish:function(){if(null!=this.element){this.element.style.setProperty(l+"transition","none"),this.element.removeEventListener(u(),this._transitionEnd,!1);var t=this.onComplete;this.onComplete=null,this.element=null,e(t)&&t()}},_transitionEnd:function(t){if(t.target===t.currentTarget&&this.stack.resolve(t.propertyName)===!0){var n={},i={};return this.stack.getCss(n,i),void this.apply(n,i)}},apply:function(t,i){t[l+"transition"]="none";var e=this.element.style,r=this.element;if(null!=t)for(var s in t)e.setProperty(s,t[s],"");getComputedStyle(r).width;var o;for(var s in i)e.setProperty(s,i[s],""),h.hasOwnProperty(s)&&(o||(o=[])).push(s);if(null!=o&&null!=n)for(var a=u(),m=0;m<o.length;m++){var f=new n(a,{propertyName:o[m],bubbles:!0,cancelable:!0});r.dispatchEvent(f)}}},t}(),p=function(){var t={},n=null,i=function(){n={keyframes:"@"+l+"keyframes",AnimationIterationCount:o+"AnimationIterationCount",AnimationDuration:o+"AnimationDuration",AnimationTimingFunction:o+"AnimationTimingFunction",AnimationFillMode:o+"AnimationFillMode",AnimationName:o+"AnimationName"}};return{create:function(e){if(null==n&&i(),null==t[e.id]){for(var r=document.styleSheets[0].insertRule(n.keyframes+" "+e.id+" {}",0),s=document.styleSheets[0].cssRules[r],o=e.frames-(e.frameStart||0),a=100/o,l=e.property||"background-position-x",u=0;o>u;u++){var h=a*(u+1)+"% { "+l+": "+-e.frameWidth*(u+(e.frameStart||0))+"px}";s.insertRule(h)}s.iterationCount=e.iterationCount,s.frameToStop=e.frameToStop,t[e.id]=s}},start:function(i,e,r){var s=i.style;s[n.AnimationName]="none",setTimeout(function(){var o=t[e];return"forwards"===s[n.AnimationFillMode]?void p.stop(i):(i.addEventListener(n+"AnimationEnd",function(){var t;if(o.frameToStop){var n=o.cssRules[o.cssRules.length-1].style;t={};for(var e=0;e<n.length;e++)t[n[e]]=n[n[e]]}p.stop(i,t)},!1),s[n.AnimationIterationCount]=o.iterationCount||1,s[n.AnimationDuration]=o.cssRules.length*r+"ms",s[n.AnimationTimingFunction]="step-start",s[n.AnimationFillMode]=o.frameToStop?"forwards":"none",void(s[n.AnimationName]=e))},0)},stop:function(t,i){var e=t.style;e[n.AnimationFillMode]="none",e[n.AnimationName]="",null!=i&&$(t).css(i)}}}();return function(){function i(t){if(null==t)return null;if(t instanceof Array){if(1===t.length)return i(t[0]);for(var r,o=t,a=s(o),l=new a,u=0,h=o.length;h>u;u++)r=o[u],a!==Array?a===Object&&(l[e(r)]=i(r.nodes)):l.push(i(r));return l}if(n.Dom.TEXTNODE===t.type)return t.content;if(n.Dom.FRAGMENT===t.type)return i(t.nodes);if(n.Dom.NODE){var m={};return m[e(t)]=i(t.nodes),m}return null}function e(t){var n=t.tagName;return 64===n.charCodeAt(0)?n.substring(1):n}function s(t){for(var i,e={},r=0,s=t.length;s>r;r++)switch(i=t[r],i.type){case n.Dom.TEXTNODE:case n.Dom.FRAGMENT:return Array;case n.Dom.NODE:if(1===e[i.tagName])return Array;e[i.tagName]=1}return Object}function o(){}var a=t.Compo;if(null==a)return void console.warn("To use :animation component, Compo should be defined");var l=1,u=2;o.prototype={constructor:o,state:l,repeat:1,step:1,delayTimer:null,slots:null,pipes:null,attr:null,render:function(t,n,e){if(null==this.nodes)return void console.warn("No Animation Model");var r,s,o,l=this.attr["x-slots"];if(null!=l)for(l=l.split(";"),this.slots={},r=0,s=l.length;s>r;r++)o=l[r].trim(),this.slots[o]=this.start;var u,h,m=this.attr["x-pipes"];if(null!=m){for(m=m.split(";"),this.pipes={},r=0,s=m.length;s>r;r++)o=m[r].trim(),u=o.indexOf("."),-1!==u?(h=o.substring(0,u),(this.pipes[h]||(this.pipes[h]={}))[o.substring(++u)]=this.start):console.error(":animation - pipeName.slotName : dot not found");a.pipe.addController(this)}this.model=new d(i(this.nodes)),this.container=e,this.attr["x-repeat"]&&(this.repeat=this.attr["x-repeat"]<<0||1/0),this.attr["x-autostart"]&&(this.slots=this.slots||{},this.slots.domInsert=this.start.bind(this))},start:function(t,n){this.delayTimer&&clearTimeout(this.delayTimer);var i=this.attr["x-delay"];return null!=i?(this.delayTimer=setTimeout(this._start.bind(this,t,n),i<<0),this):(this._start(t,n),this)},_start:function(t,n){this.state===u&&this.stop(),this.element=n||this.container,this.state=u,this.callback=t,this.step=1,this.model.start(this.element,r(this,this.nextStep))},stop:function(){this.callback&&this.callback(this),this.model.stop(),this.element=null,this.callback=null,this.state=l},nextStep:function(){return++this.step>this.repeat?this.stop():void this.model.start(this.element,r(this,this.nextStep))},dispose:function(){this.state!==l&&(this.model.onComplete=null,this.model.stop(),this.element=null,this.callback=null)}},n.registerHandler(":animation",o),a.prototype.animate=function(t,n,i){var e=this.find("#"+t);return null==e?(console.warn("Animation is not found",t),void(n&&n())):e.start(n,i)}}(),function(){function t(){}n.registerHandler(":animation:sprite",t),t.prototype={constructor:t,render:function(t,n,i){var e=this.attr,r=e.src,s=e.id,o=e.frames,a=e.property,l=e.frameWidth,u=e.frameHeight,h=e.iterationCount,m=e.msperframe,f=e.delay,c=(i.getAttribute("style")||"")+";background: url("+r+") 0 0 no-repeat; width:"+l+"px; height:"+u+"px;";i.setAttribute("style",c),p.create({id:s,frameWidth:l,frames:o,property:a,iterationCount:h,delay:f}),e.autostart&&p.start(i,s,m)}}}(),{animate:function(t,n,i){new d(n).start(t,i)},sprite:p}});
//# sourceMappingURL=mask.animation.min.js.map