!function(t,n){"use strict";null==t&&"undefined"!=typeof global&&(t=global);var i=function(){return n(t,t.mask)};if("object"==typeof exports)module.exports=i();else if("function"==typeof define&&define.amd)define(i);else{var e=i();for(var r in e)t.mask[r]=e[r]}}(this,function(t,n){"use strict";function i(t){return t instanceof Array}function e(t){return"function"==typeof t}function r(t,n){return function(){switch(arguments.length){case 0:return n.call(t);case 1:return n.call(t,arguments[0]);case 2:return n.call(t,arguments[1]);default:return n.apply(t,arguments)}}}var o=document.createElement("div").style,s=function(){return"transform"in o?"":"webkitTransform"in o?"webkit":"MozTransform"in o?"Moz":"OTransform"in o?"O":"msTransform"in o?"ms":""}(),a=function(){for(var t=["transition","webkitTransition","MozTransition","OTransition","msTransition"],n=0,i=t.length;i>n;n++)if(t[n]in o)return!0;return!1}(),l=s?"-"+s.toLowerCase()+"-":"",u=function(){var t=(document.createElement("div"),{transition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"}),n=null;for(var i in t)if(void 0!==o[i]){n=t[i];break}return(u=function(){return n})()},h={prop:l+"transition-property",duration:l+"transition-duration",timing:l+"transition-timing-function",delay:l+"transition-delay"},f="MozTransition"in o,m="msTransition"in o,c=function(){function t(t){var n=null;for(e.lastIndex=0;;){var i=e.exec(t);if(!i)return n;(n||(n={}))[i[1]]=i[0]}}function n(t){for(var n=Object.keys(t).sort().reverse(),i=0;i<n.length;i++)n[i]=t[n[i]];return n.join(" ")}function i(){this.transforms={}}var e=/([\w]+)\([^\)]+\)/g;return i.prototype={constructor:i,handle:function(i){var e=t(i.from),r=t(i.to),o=null;if(e){for(o in this.transforms)o in e==!1&&(e[o]=this.transforms[o]);i.from=n(e);for(o in e)this.transforms[o]=e[o]}for(o in this.transforms)o in r==!1&&(r[o]=this.transforms[o]);i.to=n(r);for(o in r)this.transforms[o]=r[o]}},i}(),d=function(){function t(t){var n=t.split(/ *\| */g),i={},e=n.length;i.prop=n[0]in u?l+n[0]:n[0];var r=n[1].split(/ *> */);if(r[0]&&(i.from=r[0]),i.to=r[r.length-1],e>2){var o=/(\d+m?s)?\s*([a-z]+[^\s]*)?\s*(\d+m?s)?/.exec(n[2]);if(null!=o)return i.duration=o[1]||"200ms",i.timing=o[2]||"linear",i.delay=o[3]||"0",i}return i.duration="200ms",i.timing="linear",i.delay="0",i}function n(e,r){this.parent=r,this.transformModel=r&&r.transformModel||new c;var o=e.model||e;if(i(o)){this.model=[];for(var s=0,a=o.length;a>s;s++)this.model.push(new n(o[s],this))}else if(o instanceof Object){if(o===e)return console.error('Animation Object Model has no "model" property',e),void(this.modelCount=this.nextCount=this.state=0);this.model=[new n(o,this)]}else"string"==typeof o&&(this.model=t(o),~this.model.prop.indexOf("transform")&&this.transformModel.handle(this.model));null!=e.next&&(this.next=new n(e.next,this)),this.state=0,this.nextCount=0,this.modelCount=i(this.model)?this.model.length:1,null!=this.next&&(this.nextCount=i(this.next)?this.next.length:1)}function r(t){for(var n=i(t),e=n?t.length:1,r=null,o=0;n?e>o:1>o;o++)r=n?t[o]:t,r.reset&&r.reset()}function o(t){return t?-1!==t.indexOf("ms")?parseInt(t):t.indexOf("s")?1e3*parseFloat(t):(console.warn("<mask:animation> parsing time",t),0):0}function s(t){for(var n=i(t),r=n?t.length:1,s=null,a=0,l=0;n?r>a:1>a;a++){s=n?t[a]:t;var u;u=e(s.getDuration)?s.getDuration():o(t.duration)+o(t.delay),u>l&&(l=u)}return l}function a(t,n){if(null!=t)for(var r=i(t),o=r?t.length:1,s=null,a=0;r?o>a:1>a;a++)s=r?t[a]:t,e(s.getFinalCss)?s.getFinalCss(n):n[s.prop]=s.to}var u={transform:null};return n.prototype={constructor:n,reset:function(){this.state=0,this.nextCount=0,this.modelCount=i(this.model)?this.model.length:1,null!=this.next&&(this.nextCount=i(this.next)?this.next.length:1),this.model&&r(this.model),this.next&&r(this.next)},getNext:function(){return 0===this.state?(this.state=1,this):(1===this.state&&this.modelCount>0&&--this.modelCount,1===this.state&&0===this.modelCount&&(this.state=2,this.next)?this.next:(2===this.state&&this.nextCount>0&&--this.nextCount,2===this.state&&0===this.nextCount&&this.parent?this.parent.getNext&&this.parent.getNext():null))},getDuration:function(){var t=0;return this.model&&(t+=s(this.model)),this.next&&(t+=s(this.next)),t},getFinalCss:function(t){return null==t&&(t={}),a(this.model,t),a(this.next,t),t}},n}(),p=function(){function t(){this.arr=[]}return t.prototype={constructor:t,put:function(t){if(null==t)return!1;var n,e,r=t.getNext(),o=!1;if(null==r)return!1;if(i(r)){for(e=0,n=r.length;n>e;e++)this.put(r[e])===!0&&(o=!0);return o}if(0===r.state&&(r.state=1),r.model instanceof Array){for(o=!1,e=0,n=r.model.length;n>e;e++)this.put(r.model[e])===!0&&(o=!0);return o}return this.resolve(r.model.prop),this.arr.push(r),!0},resolve:function(t){for(var n,i=0,e=this.arr.length;e>i;i++)if(n=this.arr[i],n.model.prop===t)return this.arr.splice(i,1),this.put(n);return!1},getCss:function(t,n){var i,e,r,o;for(i=0,e=this.arr.length;e>i;i++){o=this.arr[i],"from"in o.model&&(t[o.model.prop]=o.model.from),n[o.model.prop]=o.model.to;for(r in h)(n[h[r]]||(n[h[r]]=[])).push(o.model[r])}for(r in h)n[h[r]]=n[h[r]].join(",")},clear:function(){this.arr.length=0}},t}(),v=function(){function t(t){this.stack=new p,this.model=new d(t),this.duration=this.model.getDuration(),this._transitionEnd=r(this,this._transitionEnd),this.finish=r(this,this.finish),this.finishTimeout=null}for(var n,i,o=["WebKitTransitionEvent","mozTransitionEvent","oTransitionEvent","TransitionEvent"],s=0;s<o.length;s++)if(o[s]in window){i=o[s],n=window[i];break}null==i&&(i="TransitionEvent");var h={display:1,"font-family":1,visibility:1};try{new n(u(),{propertyName:"opacity",bubbles:!0,cancelable:!0})}catch(c){n=function(t,n){var e=document.createEvent(i),r="init"+i[0].toUpperCase()+i.substring(1);return e[r](u(),!0,!0,n.propertyName,0),e}}return t.prototype={constructor:t,start:function(t,n){if(this.element=t,a===!1)return this.apply(this.model.getFinalCss()),void(n&&n());t.addEventListener(u(),this._transitionEnd,!1);var i={},e={};this.onComplete=n,this.model.reset(),this.stack.clear(),this.stack.put(this.model),this.stack.getCss(i,e),this.apply(i,e),this.finishTimeout=setTimeout(this.finish,this.duration)},stop:function(){this.element.style.setProperty(l+"transition","none"),this.finish()},finish:function(){this.element.removeEventListener(u(),this._transitionEnd,!1),e(this.onComplete)&&this.onComplete(),this.onComplete=null,this.element=null},_transitionEnd:function(t){if(t.target===t.currentTarget&&this.stack.resolve(t.propertyName)===!0){var n={},i={};return this.stack.getCss(n,i),void this.apply(n,i)}},apply:function(t,i){t[l+"transition"]="none";var e=this.element.style,r=this.element;if(null!=t)for(var o in t)e.setProperty(o,t[o],"");(f||m)&&getComputedStyle(r).width,setTimeout(function(){var t;for(var o in i)e.setProperty(o,i[o],""),h.hasOwnProperty(o)&&(t||(t=[])).push(o);if(null!=t&&null!=n)for(var s=u(),a=0;a<t.length;a++){var l=new n(s,{propertyName:t[a],bubbles:!0,cancelable:!0});r.dispatchEvent(l)}},0)}},t}(),g=function(){var t={},n=null,i=function(){n={keyframes:"@"+l+"keyframes",AnimationIterationCount:s+"AnimationIterationCount",AnimationDuration:s+"AnimationDuration",AnimationTimingFunction:s+"AnimationTimingFunction",AnimationFillMode:s+"AnimationFillMode",AnimationName:s+"AnimationName"}};return{create:function(e){if(null==n&&i(),null==t[e.id]){for(var r=document.styleSheets[0].insertRule(n.keyframes+" "+e.id+" {}",0),o=document.styleSheets[0].cssRules[r],s=e.frames-(e.frameStart||0),a=100/s,l=e.property||"background-position-x",u=0;s>u;u++){var h=a*(u+1)+"% { "+l+": "+-e.frameWidth*(u+(e.frameStart||0))+"px}";o.insertRule(h)}o.iterationCount=e.iterationCount,o.frameToStop=e.frameToStop,t[e.id]=o}},start:function(i,e,r){var o=i.style;o[n.AnimationName]="none",setTimeout(function(){var s=t[e];return"forwards"===o[n.AnimationFillMode]?void g.stop(i):(i.addEventListener(n+"AnimationEnd",function(){var t;if(s.frameToStop){var n=s.cssRules[s.cssRules.length-1].style;t={};for(var e=0;e<n.length;e++)t[n[e]]=n[n[e]]}g.stop(i,t)},!1),o[n.AnimationIterationCount]=s.iterationCount||1,o[n.AnimationDuration]=s.cssRules.length*r+"ms",o[n.AnimationTimingFunction]="step-start",o[n.AnimationFillMode]=s.frameToStop?"forwards":"none",void(o[n.AnimationName]=e))},0)},stop:function(t,i){var e=t.style;e[n.AnimationFillMode]="none",e[n.AnimationName]="",null!=i&&$(t).css(i)}}}();return function(){function i(t){if(null==t)return null;if(t instanceof Array){if(1===t.length)return i(t[0]);for(var r,s=t,a=o(s),l=new a,u=0,h=s.length;h>u;u++)r=s[u],a!==Array?a===Object&&(l[e(r)]=i(r.nodes)):l.push(i(r));return l}if(n.Dom.TEXTNODE===t.type)return t.content;if(n.Dom.FRAGMENT===t.type)return i(t.nodes);if(n.Dom.NODE){var f={};return f[e(t)]=i(t.nodes),f}return null}function e(t){var n=t.tagName;return 64===n.charCodeAt(0)?n.substring(1):n}function o(t){for(var i,e={},r=0,o=t.length;o>r;r++)switch(i=t[r],i.type){case n.Dom.TEXTNODE:case n.Dom.FRAGMENT:return Array;case n.Dom.NODE:if(1===e[i.tagName])return Array;e[i.tagName]=1}return Object}function s(){}var a=t.Compo;if(null==a)return void console.warn("To use :animation component, Compo should be defined");var l=1,u=2;s.prototype={constructor:s,state:l,repeat:1,step:1,render:function(t,n,e){if(null==this.nodes)return void console.warn("No Animation Model");var r,o,s,l=this.attr["x-slots"];if(null!=l)for(l=l.split(";"),this.slots={},r=0,o=l.length;o>r;r++)s=l[r].trim(),this.slots[s]=this.start;var u,h,f=this.attr["x-pipes"];if(null!=f){for(f=f.split(";"),this.pipes={},r=0,o=f.length;o>r;r++)s=f[r].trim(),u=s.indexOf("."),-1!==u?(h=s.substring(0,u),(this.pipes[h]||(this.pipes[h]={}))[s.substring(++u)]=this.start):console.error(":animation - pipeName.slotName : dot not found");a.pipe.addController(this)}this.model=new v(i(this.nodes)),this.container=e,this.attr["x-repeat"]&&(this.repeat=this.attr["x-repeat"]<<0||1/0)},start:function(t,n){return this.state===u&&this.stop(),this.element=n||this.container,this.state=u,this.callback=t,this.step=1,this.model.start(this.element,r(this,this.nextStep)),this},stop:function(){this.callback&&this.callback(this),this.model.stop(),this.element=null,this.callback=null,this.state=l},nextStep:function(){return++this.step>this.repeat?this.stop():void this.model.start(this.element,r(this,this.nextStep))}},n.registerHandler(":animation",s),a.prototype.animate=function(t,n,i){var e=this.find("#"+t);return null==e?(console.warn("Animation is not found",t),void(n&&n())):e.start(n,i)}}(),function(){function t(){}n.registerHandler(":animation:sprite",t),t.prototype={constructor:t,render:function(t,n,i){var e=this.attr,r=e.src,o=e.id,s=e.frames,a=e.property,l=e.frameWidth,u=e.frameHeight,h=e.iterationCount,f=e.msperframe,m=e.delay,c=(i.getAttribute("style")||"")+";background: url("+r+") 0 0 no-repeat; width:"+l+"px; height:"+u+"px;";i.setAttribute("style",c),g.create({id:o,frameWidth:l,frames:s,property:a,iterationCount:h,delay:m}),e.autostart&&g.start(i,o,f)}}}(),{animate:function(t,n,i){new v(n).start(t,i)},sprite:g}});
//# sourceMappingURL=mask.animation.min.js.map