!function(n,t){"use strict";var e,r;"undefined"==typeof exports||n!==exports&&null!=n||(e=r=global),null==e&&(e="undefined"==typeof window?global:window),null==r&&(r=n||e),e.$L=t(e,r),"undefined"!=typeof module&&(module.exports=global.$L)}(this,function(n){"use strict";function t(n,t,e){var r=t.exec(n);return r&&r[e]?r[e]:null}function e(){}function r(){return console.warn('<localizer> In node env. please call $L.fromReq(req)("someKey")'),S(x[0])}var a=Array.prototype.slice,i=!("undefined"==typeof window||!window.document),o=!i,l=n.include||n.atma&&n.atma.include,u=n.mask||n.atma&&n.atma.mask,s=n.Class||n.atma&&n.atma.Class;if(null==l&&o){var f=require("atma-libs/exports");l=f.include,u=f.mask,s=f.Class}var c=o?require("atma-formatter"):window.Formatter||u&&u.$utils.format;if(null==c)throw Error("atma-formatter is not preloaded.");var d,v,g;!function(){d=function(n,t){for(var e=t.split("."),r=e.length,a=-1;++a<r;){if(null==n)return null;n=n[e[a]]}return n},v=function(n,t,e){for(var r,a=t.split("."),i=a.length,o=-1;++o<i-1;)r=a[o],null==n[r]&&(n[r]={}),n=n[r];n[a[o]]=e},g=function(n,t){if(null==n&&(n={}),null==t)return n;var e,r;for(r in t)e=t[r],null!=e&&(n[r]=e);return n}}();var h;!function(){h=function(){var n=a.call(arguments);n.unshift("<i18n>"),console.log.apply(console,n)}}();var p,m;!function(){function e(n){return t(n,/language=(\w+)/,1)}p=function(){var r=e(n.location.search);return null==r&&(r=t(n.navigator.language,/^(\w+)/,1)),r=r.toLowerCase(),w(r)?r:x[0]},m=function(n){var t,r,a=n.url.indexOf("?");if(-1!==a){var i=n.url.substring(n.url);if(t=e(i),w(t))return t}if(r=n.headers["accept-language"],!r)return x[0];r=r.replace(/\s*/g,"").toLowerCase();for(var o,l,u=r.split(","),s=u.length,f=-1;++f<s;)if(l=u[f],o=l.indexOf(";"),t=-1===o?l:l.substring(0,o),w(t))return t;return x[0]}}();var y,w,_,j={},x=["en"];!function(n){w=function(n){return-1!==x.indexOf(n)},y=function(t,e){return null!=e?null==n[t]?void(n[t]=e):void g(n[t],e):void 0},_=function(n){var t=l&&l.route&&l.route.params;if(null!=t){t.support&&(x=t.support.split(","));var e=t.path;return e?i?void L.loadSingle({path:e}).done(n):void L.loadAll({path:e}).done(n):void(n&&n())}}}(j),function(){function n(n,t,e,r){return null==r?n:(null!=t?r.apply(n,t):e.push(r),n)}function t(n){n._done=null,n._fail=null,n._always=null}function r(n,t,e){if(null!=n){for(var r,a=n.length,i=-1;++i<a;)r=n[i],r&&r.apply(t,e);n.length=0}}function a(n,t){return function(){return n.apply(t,arguments)}}e.prototype={_isAsync:!0,_done:null,_fail:null,_always:null,_resolved:null,_rejected:null,defer:function(){this._rejected=null,this._resolved=null},resolve:function(){var n=this._done,e=this._always;return this._resolved=arguments,t(this),r(n,this,arguments),r(e,this,[this]),this},reject:function(){var n=this._fail,e=this._always;return this._rejected=arguments,t(this),r(n,this,arguments),r(e,this,[this]),this},resolveDelegate:function(){return a(this.resolve,this)},rejectDelegate:function(){return a(this.reject,this)},then:function(n,t){return this.done(n).fail(t)},done:function(t){return n(this,this._resolved,this._done||(this._done=[]),t)},fail:function(t){return n(this,this._rejected,this._fail||(this._fail=[]),t)},always:function(t){return n(this,this._rejected||this._resolved,this._always||(this._always=[]),t)}}}();var L;!function(){var t={};!function(){function n(n,t){if(null==l&&i)return void e(n,function(n){t(n)});var r=o?l.instance():l;r.ajax(n+"::Data").done(function(n){t(n.ajax.Data)})}function e(n,t){var e=new XMLHttpRequest;e.onload=function(){var n;try{n=JSON.parse(e.responseText)}catch(r){h("Should be json",r)}finally{t(n)}},e.open("get",n,!0),e.send()}t.file={single:function(t,e,r){n(e,function(n){y(t,n),r()})},many:function(n,t,e){function r(){--a<0&&e()}for(var a=t.length,i=a,o=-1;++o<i;)this.single(t[o],n.replace("%%",t[o]),r)},loadFromAtmaBackend:function(t){n("/atma/i18n.json",function(n){return null==n?void console.error("i18n: Atma Backend failed"):(y(n.lang||"en",n),void(t&&t()))})}}}(),t.directory=function(t,e){var r=n.io||n.atma&&f.io,a=r&&r.glob;if(null==a){try{r=require("atma-io")}catch(i){throw h("run `npm i atma-io -save`"),i}a=r.glob}var o=[];a.readFiles(t).forEach(function(n){var t=n.uri.getName(),e=n.read();if("string"==typeof e)try{e=JSON.parse(e)}catch(r){return void h("Failed to load translations",n.uri.toLocalFile())}y(t,e)}),0===o.length&&h("No translations",t),e()};var r={};L={loadAll:function(n){function t(){--r<0&&o.resolve()}n.support&&(x=n.support);for(var r=x.length,a=r,i=-1;++i<a;)n.lang=x[i],this.loadSingle(n).done(t);var o=new e;return o},loadSingle:function(n,a){n.support&&(x=n.support);var i=n.lang,l=n.path;if(null==i&&(i=o?m(a):p()),l){if(l.indexOf("%%")&&(l=l.replace("%%",i)),r[l])return r[l];var u=r[l]=new e;return t.file.single(i,l,u.resolveDelegate()),u}h("<Single Load: implemented `config.path` only>")},loadFromAtmaBackend:t.file.loadFromAtmaBackend}}();var S;!function(n){function t(t){var e=n[t];null==e&&console.error("<localization> Translation is not defined for",t);var r=function(n){var t,r=null==e?n:e[n];return null==r&&(console.warn("<localization> No translation for",n),r=n),1===arguments.length?r:(t=a.call(arguments),t[0]=r,c.apply(null,t))};r.lang=t,r.extend=y,r.translation=e;var i;return r.stringify=function(){return i||(i=JSON.stringify(e))},r}S=function(n){return null==e[n]?e[n]=t(n):e[n]};var e={}}(j);var b;!function(){b=function(){return n.apply(null,arguments)};var n=function(){return n=S(p()),n.apply(null,arguments)}}(),r.fromReq=function(n){if(void 0!==n.$L)return n.$L;var t=m(n),e=S(t);return n.$L=e};var q=o?r:b;if(null!=u){var A,k;!function(){function n(n,e){return n.apply(null,t(e))}function t(n){var t=n[0].trim(),r=n[1],a=n[2],i=n[4];switch(t.charCodeAt(0)){case 40:case 34:case 39:return e(t,r,a,i)}var o=t.indexOf(",");return-1===o?[t]:(n=e(t.substring(o+1),r,a,i),n.unshift(t.substring(0,o)),n)}A=function(t,e,r){return n(q.fromReq(r.req),arguments)},k=function(){return n(q,arguments)};var e=u.Utils.Expression.evalStatements}(),u.registerUtil("L",o?A:k)}return q.loadSingle=L.loadSingle,q.resolveFromAtmaBackend=L.loadFromAtmaBackend,function(){function n(n,t,e){return"/atma/i18n.json"!==n.url?!1:(q.loadSingle(e,n).done(function(){var e=q.fromReq(n),r=e.stringify(),a=200;null==r&&(a=500,r='{"error":"Language not defined: '+e.lang+'"}'),t.writeHead(200,{"Content-Length":r.length,"Content-Type":"application/json"}),t.end(r)}),!0)}o&&(q.middleware=function(t){return function(e,r,a){n(e,r,t,a)||q.loadSingle(t,e).done(function(){q.fromReq(e),a()})}},q.jsonLang=function(t){return function(e,r,a){n(e,r,t,a)||a()}})}(),_(),q});
//# sourceMappingURL=localization.min.js.map