UTest({
	'queue': function(done) {
		
		Queue
			.TaskFactory
			.ensureTask({
				name: 'test-foo',
				
				trigger: 'in 200ms',
				exec: {
					script: 'global.XX = "test-foo";',
				}
			});
		
		Queue
			.TaskQueue
			.on('hasNewTasks', function(queue){
				eq_(queue.length, 1);
				
				var q/*QueuedTask*/ = queue[0];
				is_(q._id, 'Object');
				
				is_(q._task, 'Object');
				eq_(q._task.name, 'test-foo');
				eq_(q.tid, q._task._id.toString());
				done();
			});
	},
	
	'pluck': function(done){
		Queue
			.TaskQueue
			.pluck('foo_workerid')
			.fail(assert.avoid())
			.done(function(h/*HistoryTask*/){
				
				is_(h.start, 'Date');
				is_(h._id, 'Object');
				eq_(h.task.name, 'test-foo');
				is_(h.task._id, 'Object');
				
				eq_(Queue.TaskQueue.length, 0);
				done(h);
			})
	},
	'ensureNoQueue': function(done, h/*HistoryTask*/){
		Queue
			.TaskQueue
			.restore()
			.fail(assert.avoid())
			.done(function(queue){
				eq_(Queue.TaskQueue, queue);
				eq_(queue.length, 0);
				done(h);
			})
	},
	'finish': function(done, h/*HistoryTask*/){
		
		eq_(Queue.TaskHistory.length, 1, 'Has?');
		h
			.log('foo-log')
			.fail(assert.avoid())
			.done(finish)
			;
		
		function finish() {
			Queue
			.TaskQueue
			.finish(h._id.toString())
			.fail(assert.avoid())
			.done(function(h){
				
				eq_(Queue.TaskHistory.length, 0);
				
				is_(h.end, 'Date');
				is_(h.logs, 'Array');
				
				eq_(h.logs[0], 'foo-log');
				eq_(h.state, Model.HistoryTask.state_Finished, 'State?');
				
				done();
			});
		}
	}
})